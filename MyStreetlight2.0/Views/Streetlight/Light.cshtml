@{
	ViewData["Title"] = "Streetlight";
}

@* Import feedback partial here *@
@await Html.PartialAsync("_Feedback")

<div class="mx-2 sm:mx-6">
	<!-- Header -->
	<div class="glass-card rounded-2xl border border-[#abb3c2] !shadow-sm dark:border-[rgba(255,255,255,0.125)]">
		<div class="px-4 py-5 sm:px-6 lg:px-8">
			<!-- Main header row -->
			<div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
				<!-- Left side - Streetlight info -->
				<div class="flex items-center">
					<div class="from-primary-500 to-primary-700 mr-3 flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br text-white shadow-lg">
						<i class="fas fa-lightbulb text-xl"></i>
					</div>
					<div>
						<h1 class="text-xl font-bold sm:text-2xl">@Model.LightId</h1>
						<p class="flex flex-col gap-1 text-xs text-gray-600 dark:text-gray-400 sm:flex-row sm:items-center sm:gap-2 sm:text-sm md:my-0.5">
							<span class="font-medium">
								@if (Model.LastUpdate == DateTime.MaxValue)
								{
									@:Not Available
								}
								else
								{
									@Model.LastUpdate.ToString("dd MMM yyyy HH:mm")
								}
							</span>
							<span class="hidden sm:inline">•</span>
							<span>@Model.Address</span>
						</p>
					</div>
				</div>

				<!-- Right side - Controls and buttons -->
				<div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-2">
					<div class="glass-card flex flex-wrap items-center justify-evenly gap-1 rounded-xl p-0.5 shadow-inner sm:justify-center sm:gap-1.5 sm:p-1.5">
						@* <a href="javascript:void(0);"
						   onclick="sendCommandForLight('@Model.GatewayId', '@Model.NodeId', '@Model.LightId', 1)"
						   class="flex items-center justify-center rounded-lg bg-gradient-to-br from-green-500 to-green-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-green-600 hover:to-green-700 hover:shadow-lg">
							<i class="fas fa-play-circle mr-1.5 text-xs"></i> ON
						</a>
						<a href="javascript:void(0);"
						   onclick="sendCommandForLight('@Model.GatewayId', '@Model.NodeId', '@Model.LightId', 0)"
						   class="flex items-center justify-center rounded-lg bg-gradient-to-br from-red-500 to-red-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-red-600 hover:to-red-700 hover:shadow-lg">
							<i class="fas fa-stop-circle mr-1.5 text-xs"></i> OFF
						</a>
						<a href="javascript:void(0);"
						   onclick="sendCommandForLight('@Model.GatewayId', '@Model.NodeId', '@Model.LightId', 2)"
						   class="pulse flex items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-blue-600 hover:to-blue-700 hover:shadow-lg">
							<i class="fas fa-bolt mr-1.5 text-xs"></i> Test
						</a> *@
						<form method="POST" action="/Streetlight/SaveActionCommand?gatewayId=@Model.GatewayId&nodeId=@Model.NodeId&lightId=@Model.LightId&actionId=1"
							  onclick="this.submit();"
							  class="flex cursor-pointer items-center justify-center rounded-lg bg-gradient-to-br from-green-500 to-green-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-green-600 hover:to-green-700 hover:shadow-lg">
							<i class="fas fa-play-circle mr-1.5 text-xs"></i> ON
						</form>
						<form method="POST" action="/Streetlight/SaveActionCommand?gatewayId=@Model.GatewayId&nodeId=@Model.NodeId&lightId=@Model.LightId&actionId=0"
							  onclick="this.submit();"
							  class="flex cursor-pointer items-center justify-center rounded-lg bg-gradient-to-br from-red-500 to-red-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-red-600 hover:to-red-700 hover:shadow-lg">
							<i class="fas fa-stop-circle mr-1.5 text-xs"></i> OFF
						</form>
						<form method="POST" action="/Streetlight/SaveActionCommand?gatewayId=@Model.GatewayId&nodeId=@Model.NodeId&lightId=@Model.LightId&actionId=2"
							  onclick="this.submit();"
							  class="pulse flex cursor-pointer items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-blue-600 hover:to-blue-700 hover:shadow-lg">
							<i class="fas fa-bolt mr-1.5 text-xs"></i> Test
						</form>

						<div class="hidden h-6 border-l border-gray-300 dark:border-gray-600 sm:block"></div>

						<button class="from-primary-500 to-primary-600 flex items-center justify-center rounded-lg bg-gradient-to-br px-3 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-primary-600 hover:to-primary-700 hover:shadow-lg">
							<i class="fas fa-download mr-1.5"></i> Reports
						</button>
					</div>
				</div>
			</div>

			<!-- Status Bar -->
			<div class="mt-2 flex flex-col gap-3 border-t border-gray-200 py-3 dark:border-gray-700 sm:flex-row sm:items-center sm:justify-between">
				<div class="flex flex-wrap gap-4">
					<div class="flex items-center rounded-full @(Model.PowerStatus == "ON" ? "bg-green-100 dark:bg-green-900/30" : "bg-red-100 dark:bg-red-900/30") px-3 py-1.5">
						@* <span class="status-active mr-2 inline-block h-2.5 w-2.5 rounded-full"></span> *@
						<span class="text-sm font-medium @(Model.PowerStatus == "ON" ? "text-green-800 dark:text-green-200" : "text-red-800 dark:text-red-200")">
							Light: @Model.PowerStatus
						</span>
					</div>
					<div class="flex items-center rounded-full bg-blue-100 px-3 py-1.5 dark:bg-blue-900/30">
						@* <span class="status-active mr-2 inline-block h-2.5 w-2.5 rounded-full"></span> *@
						<span class="text-sm font-medium text-blue-800 dark:text-blue-200">Connected</span>
					</div>
				</div>
				<div class="text-center text-sm font-medium text-gray-600 dark:text-gray-400 sm:text-right">
					Light ID: @Model.LightId • Zone: @Model.Zone • Ward: @Model.Ward
				</div>
			</div>
		</div>
	</div>

	<!-- Cards Section -->
	<div class="grid-cols-1 mt-1.5 grid gap-1.5 lg:grid-cols-4">
		<!-- Identification Card -->
		<div class="glass-card gradient-border rounded-2xl border border-[#abb3c2] p-6 shadow-lg dark:border-[rgba(255,255,255,0.125)]">
			<h2 class="mb-4 flex items-center text-lg font-semibold">
				<div class="bg-primary-100 text-primary-600 mr-2 flex h-8 w-8 items-center justify-center rounded-lg dark:bg-primary-900/30 dark:text-primary-300">
					<i class="fas fa-fingerprint"></i>
				</div>
				Identification
			</h2>
			<div class="space-y-4">
				<div class="rounded-xl bg-gray-100 p-4 dark:bg-gray-800/50">
					<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Gateway ID</p>
					<a asp-action="Gateway" asp-controller="Gateway" asp-route-gatewayId="@Model.GatewayId">
						<span class="font-semibold text-blue-600 hover:underline">@Model.GatewayId</span>
					</a>
				</div>
				<div class="grid-cols-2 grid gap-4">
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Light ID</p>
						<p class="font-medium">@Model.LightId</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Mac ID</p>
						<p class="font-medium">@Model.MacId</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Zone</p>
						<p class="font-medium">@Model.Zone</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Ward</p>
						<p class="font-medium">@Model.Ward</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Poll No</p>
						<p class="font-medium">@Model.PollNo</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Wattage</p>
						<p class="font-medium">@Model.Wattage W</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">A</p>
						<p class="font-medium">@Model.Current</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Light On Hour</p>
						<p class="font-medium">@Model.LightOnHour</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Location Card -->
		<div class="glass-card gradient-border rounded-2xl border border-[#abb3c2] p-6 shadow-lg dark:border-[rgba(255,255,255,0.125)]">
			<h2 class="mb-4 flex items-center text-lg font-semibold">
				<div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-300">
					<i class="fas fa-map-marker-alt"></i>
				</div>
				Location
			</h2>
			<div class="space-y-4">
				<div>
					<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Address</p>
					<p class="font-medium">@Model.Address</p>
				</div>
				<div class="grid-cols-2 grid gap-4">
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Latitude</p>
						<p class="font-medium">@Model.Latitude</p>
					</div>
					<div>
						<p class="text-xs font-medium text-gray-500 dark:text-gray-400">Longitude</p>
						<p class="font-medium">@Model.Longitude</p>
					</div>
				</div>
				<!-- Leaflet Map -->
				<div id="leafletMap" class="relative mt-2 h-48 w-full overflow-hidden rounded-xl border border-[#abb3c2] dark:border-[rgba(255,255,255,0.125)]"></div>
			</div>
		</div>

		<!-- Energy Consumption Chart -->
		<div class="glass-card gradient-border rounded-2xl border border-[#abb3c2] p-6 shadow-lg dark:border-[rgba(255,255,255,0.125)] sm:col-span-2">
			<div class="mb-4 flex items-center justify-between">
				<h2 class="flex items-center text-lg font-semibold">
					<div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-300">
						<i class="fas fa-chart-line"></i>
					</div>
					Energy Consumption
				</h2>
			</div>
			<div class="h-64">
				<canvas id="energyChart"></canvas>
			</div>
			<div class="flex items-center justify-center space-x-2">
				<button class="bg-primary-500 rounded-lg px-3 py-1.5 text-xs font-medium text-white shadow-md transition-colors hover:bg-primary-600">Day</button>
				<button class="rounded-lg bg-gray-200 px-3 py-1.5 text-xs font-medium text-gray-700 shadow-md transition-colors hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">Week</button>
				<button class="rounded-lg bg-gray-200 px-3 py-1.5 text-xs font-medium text-gray-700 shadow-md transition-colors hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">Month</button>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="~/js/misc/actioncommand.js?v=@DateTime.Now.Ticks"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		// Replace with your server-side values
		const lat = @Model.Latitude;
		const lng = @Model.Longitude;

		// Init map
		const map = L.map("leafletMap").setView([lat, lng], 15);

		// Add OpenStreetMap tiles
		L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
			attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
		}).addTo(map);

		// Add marker
		L.marker([lat, lng])
			.addTo(map)
			.bindPopup("<b>Streetlight Location</b><br>@Model.Address")
			.openPopup();
	});

	// Energy Consumption Chart
	const energyCtx = document.getElementById('energyChart').getContext('2d');
	const energyChart = new Chart(energyCtx, {
		type: 'line',
		data: {
			labels: ['12am', '3am', '6am', '9am', '12pm', '3pm', '6pm', '9pm'],
			datasets: [{
				label: 'Energy (Watt-hours)',
				data: [0, 0, 0, 0, 0, 0, 450, 1200],
				borderColor: '#3b82f6',
				backgroundColor: 'rgba(59, 130, 246, 0.1)',
				fill: true,
				tension: 0.3,
				pointRadius: 4,
				pointBackgroundColor: '#3b82f6',
				pointBorderColor: '#fff',
				pointBorderWidth: 2,
				borderWidth: 2
			}]
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			plugins: {
				legend: {
					display: false
				}
			},
			scales: {
				y: {
					beginAtZero: true,
					grid: {
						color: 'rgba(0, 0, 0, 0.05)'
					}
				},
				x: {
					grid: {
						display: false
					}
				}
			}
		}
	});
</script>


@* <!-- Power Metrics Card -->
            <div class="glass-card gradient-border card-hover rounded-2xl p-6 shadow-lg">
                <h2 class="mb-4 flex items-center text-lg font-semibold">
                    <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-300">
                        <i class="fas fa-bolt"></i>
                    </div>
                    Power Metrics
                </h2>
                <div class="space-y-4">
                    <div class="grid-cols-2 grid gap-4">
                        <div class="rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 p-4 dark:from-blue-900/30 dark:to-blue-800/30">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400">Voltage</p>
                            <p class="text-xl font-bold text-blue-600 dark:text-blue-300">220<span class="text-sm font-normal">V</span></p>
                        </div>
                        <div class="rounded-xl bg-gradient-to-br from-green-50 to-green-100 p-4 dark:from-green-900/30 dark:to-green-800/30">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400">Current</p>
                            <p class="text-xl font-bold text-green-600 dark:text-green-300">2.8<span class="text-sm font-normal">A</span></p>
                        </div>
                        <div class="rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 p-4 dark:from-purple-900/30 dark:to-purple-800/30">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400">Power</p>
                            <p class="text-xl font-bold text-purple-600 dark:text-purple-300">616<span class="text-sm font-normal">W</span></p>
                        </div>
                        <div class="rounded-xl bg-gradient-to-br from-cyan-50 to-cyan-100 p-4 dark:from-cyan-900/30 dark:to-cyan-800/30">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400">Load</p>
                            <p class="text-xl font-bold text-cyan-600 dark:text-cyan-300">45<span class="text-sm font-normal">%</span></p>
                        </div>
                    </div>
                    <div class="pt-2">
                        <p class="text-xs font-medium text-gray-500 dark:text-gray-400">Units Consumed</p>
                        <p class="text-lg font-bold">124.5 kWh</p>
                    </div>
                </div>
            </div>

            <!-- Status Overview Card -->
            <div class="glass-card gradient-border card-hover rounded-2xl p-6 shadow-lg">
                <h2 class="mb-4 flex items-center text-lg font-semibold">
                    <div class="mr-2 flex h-8 w-8 items-center justify-center rounded-lg bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-300">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    Status Overview
                </h2>
                <div class="space-y-3">
                    <div class="flex items-center justify-between rounded-xl bg-green-50 p-3 dark:bg-green-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-active"></span>
                            <span>Light Status</span>
                        </div>
                        <span class="font-medium text-green-600 dark:text-green-400">ON</span>
                    </div>
                    <div class="flex items-center justify-between rounded-xl bg-blue-50 p-3 dark:bg-blue-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-active"></span>
                            <span>Mode</span>
                        </div>
                        <span class="font-medium">AUTO</span>
                    </div>
                    <div class="flex items-center justify-between rounded-xl bg-green-50 p-3 dark:bg-green-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-active"></span>
                            <span>Meter Status</span>
                        </div>
                        <span class="font-medium text-green-600 dark:text-green-400">OK</span>
                    </div>
                    <div class="flex items-center justify-between rounded-xl bg-green-50 p-3 dark:bg-green-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-active"></span>
                            <span>Relay Status</span>
                        </div>
                        <span class="font-medium text-green-600 dark:text-green-400">ON</span>
                    </div>
                    <div class="flex items-center justify-between rounded-xl bg-red-50 p-3 dark:bg-red-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-inactive"></span>
                            <span>MCB Status</span>
                        </div>
                        <span class="font-medium text-red-600 dark:text-red-400">OFF</span>
                    </div>
                    <div class="flex items-center justify-between rounded-xl bg-green-50 p-3 dark:bg-green-900/20">
                        <div class="flex items-center">
                            <span class="status-indicator status-active"></span>
                            <span>Door Status</span>
                        </div>
                        <span class="font-medium text-green-600 dark:text-green-400">CLOSED</span>
                    </div>
                </div>
            </div> *@